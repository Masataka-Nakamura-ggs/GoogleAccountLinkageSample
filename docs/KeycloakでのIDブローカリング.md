# KeycloakでのIDブローカリング

## Googleでログイン
Keycloakに「Googleでログイン」機能を追加するには、大きく分けて **「Google側での設定」** と **「Keycloak側での設定」** の2つのステップが必要です。

以下に、具体的な手順をステップバイステップで解説します。

-----

### **ステップ1：Google側での設定（クライアントIDとシークレットの取得）**

まず、Googleに「KeycloakがGoogleの認証を使いたがっています」と申請し、許可証をもらう作業をします。

1.  **Google Cloud Platform (GCP) コンソールにアクセス**

      * Googleアカウントで[GCPコンソール](https://console.cloud.google.com/)にログインします。
      * 初めての場合は、プロジェクトを作成してください。既存のプロジェクトがあればそれを使用します。

2.  **OAuthクライアントIDの作成画面へ移動**

      * 左上のナビゲーションメニュー `☰` から、「APIとサービス」 > 「**認証情報**」を選択します。

3.  **認証情報を作成**

      * 画面上部の「**+ 認証情報を作成**」をクリックし、「**OAuth クライアント ID**」を選択します。

4.  **OAuthクライアントIDの設定**

      * **アプリケーションの種類:** 「**ウェブ アプリケーション**」を選択します。
      * **名前:** 自分でわかりやすい名前を入力します（例: `Keycloak連携`）。
      * **承認済みのリダイレクト URI:** ここが**最も重要なポイント**です。KeycloakがGoogleからの認証結果を受け取るためのURLを設定します。
          * Keycloakの管理コンソールを開き、`レルム設定 > 全般`タブにある「エンドポイント」のリンクをクリックし、「OpenID Endpoint Configuration」を開いて`authorization_endpoint`のURLを確認します。
          * 一般的には以下の形式になります。
        ```
        https://<あなたのKeycloakのドメイン>/realms/<あなたのレルム名>/broker/google/endpoint
        ```
          * このURLをコピーして、「承認済みのリダイレクト URI」の「+ URI を追加」ボタンを押して貼り付けます。

5.  **クライアントIDとシークレットをコピー**

      * 「作成」ボタンをクリックすると、「**クライアント ID**」と「**クライアント シークレット**」が表示されます。
      * この2つの情報を、必ずメモ帳などにコピーしておいてください。後でKeycloak側の設定で使います。

これで、Google側の準備は完了です。

-----

### **ステップ2：Keycloak側での設定（GoogleをIDプロバイダーとして追加）**

次に、Keycloakに「この許可証（クライアントIDとシークレット）を使ってGoogleと連携してください」と設定します。

1.  **Keycloak管理コンソールにログイン**

      * 管理者アカウントでKeycloakにログインします。

2.  **レルムを選択**

      * Googleログインを設定したいレルムを、左上のドロップダウンから選択します。

3.  **IDプロバイダーの追加画面へ移動**

      * 左側のメニューから「**Identity Providers**」をクリックします。

4.  **Googleを選択**

      * 「Add provider...」のドロップダウンリストから「**Google**」を選択します。

5.  **クライアントIDとシークレットを入力**

      * 設定画面が表示されたら、先ほどステップ1でGoogleから取得した「**クライアント ID**」と「**クライアント シークレット**」を、それぞれの入力欄に貼り付けます。
      * 他の設定は、まずはデフォルトのままで問題ありません。

6.  **保存**

      * ページ下部にある「**Save**」ボタンをクリックします。

-----

### **設定の確認**

これで全ての設定は完了です！
実際にあなたのアプリケーションのログインページにアクセスすると、Keycloakが提供するログイン画面に**「Google」でログインするためのボタンが表示されているはずです。**

もし表示されない場合は、Keycloakの `Authentication` > `Flows` の設定で、`Identity Provider Redirector` が有効になっているかを確認してください（通常はデフォルトで有効です）。